# This is simple workflow to test kedro new command

name: "Test `kedro new`"

on: [push]

jobs:
  test_kedro_new:
    name: "Test kedro new"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.9", "3.10"]
        starter_name: ["mini-poetry"]

    steps:
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install kedro
        run: |
          python -m pip install --upgrade pip
          pip install kedro

      - name: Run kedro new
        run: kedro new --starter ./${{ matrix.starter_name }} --config tests/${{ matrix.starter_name }}/config.yml --directory test-project-${{ matrix.starter_name }}

      - name: Check that the project was created
        run: |
          "[ -d test-project-${{ matrix.starter_name }} ]"
          "[ -f test-project-${{ matrix.starter_name }}/README.md ]"
          "[ -f test-project-${{ matrix.starter_name }}/src/test_project_${{ matrix.starter_name }}/settings.py ]"
          "[ -f test-project-${{ matrix.starter_name }}/src/test_project_${{ matrix.starter_name }}/pipeline_registry.py ]"
          "[ -f test-project-${{ matrix.starter_name }}/src/test_project_${{ matrix.starter_name }}/__init__.py ]"
          "[ -f test-project-${{ matrix.starter_name }}/src/test_project_${{ matrix.starter_name }}/__main__py ]"
